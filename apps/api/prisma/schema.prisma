// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Vendor {
  id        String    @id @default(cuid())
  name      String
  taxId     String?
  address   Json?
  contact   Json?
  category  String?
  invoices  Invoice[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([name])
}

model Customer {
  id        String    @id @default(cuid())
  name      String
  email     String?
  contact   Json?
  address   Json?
  invoices  Invoice[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([name])
}

model Invoice {
  id            String     @id @default(cuid())
  invoiceNumber String     @unique
  vendor        Vendor     @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId      String
  customer      Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId    String
  issueDate     DateTime
  dueDate       DateTime?
  status        String     // e.g., "paid", "pending", "overdue"
  subtotal      Decimal    @db.Decimal(12, 2)
  tax           Decimal?   @db.Decimal(12, 2)
  total         Decimal    @db.Decimal(12, 2)
  currency      String     @default("USD")
  description   String?
  notes         String?
  lineItems     LineItem[]
  payments      Payment[]
  rawJson       Json?      // Store original JSON for reference
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([vendorId])
  @@index([customerId])
  @@index([issueDate])
  @@index([status])
  @@index([invoiceNumber])
}

model LineItem {
  id          String   @id @default(cuid())
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoiceId   String
  description String
  quantity    Int      @default(1)
  unitPrice   Decimal? @db.Decimal(12, 2)
  total       Decimal  @db.Decimal(12, 2)
  category    String?  // e.g., "Office Supplies", "Services", etc.
  createdAt   DateTime @default(now())

  @@index([invoiceId])
  @@index([category])
}

model Payment {
  id            String   @id @default(cuid())
  invoice       Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoiceId     String
  amount        Decimal  @db.Decimal(12, 2)
  paidAt        DateTime
  method        String?  // e.g., "credit_card", "bank_transfer", "check"
  transactionId String?
  notes         String?
  createdAt     DateTime @default(now())

  @@index([invoiceId])
  @@index([paidAt])
}
